node('maven') {
            stage ("Get Source code"){
                  echo '*** Build tarting ***'
                  def mvn = "mvn -s mvn-settings.xml"
                  git url : 'https://github.com/demo-redhat-forum-2018/monolith.git'
                  
                  //write Nexus configfile
                  
     writeFile file: 'mvn-settings.xml', text: """
<?xml version="1.0"?>
<settings>
  <mirrors>
    <mirror>
      <id>Nexus</id>
      <name>Nexus Public Mirror</name>
      <url>${params.NEXUS_MIRROR_URL}</url>
      <mirrorOf>*</mirrorOf>
    </mirror>
  </mirrors>
  <servers>
    <server>
      <id>nexus</id>
      <username>${params.NEXUS_USER}</username>
      <password>${params.NEXUS_PASSWORD}</password>
    </server>
  </servers>
</settings>
"""
       
        }
          def pom            = readMavenPom file: 'pom.xml'
          def packageName    = pom.name
          def version        = pom.version
          def newVersion     = "${version}-${BUILD_NUMBER}"
          def artifactId     = pom.artifactId
          def groupId        = pom.groupId

          // Using Maven build the war file
          // Do not run tests in this step
          stage('Build war file') {
            sh "mvn -s mvn-settings.xml clean install -DskipTests=true"
          }         
          
           stage('Publish to Nexus') {
            sh "mvn -s mvn-settings.xml deploy -DskipTests=true -DaltDeploymentRepository=nexus::default::${params.NEXUS_REPO_URL}"
          }
             }